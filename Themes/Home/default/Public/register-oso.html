<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{$title|default=''}<?php echo C('SITE_TITLE'); ?></title>
  <meta name="keywords" content="{$meta_keywords|default=''}" />
  <meta name="description" content="{$meta_description|default=''}" />  
  
  <link type="image/x-icon" href="__ROOT__/<?php echo resize(C('SITE_ICON'),16,16); ?>" rel="icon">
  <link type="image/x-icon" href="__ROOT__/<?php echo resize(C('SITE_ICON'),16,16); ?>" rel="bookmark">

  <link href="__PUBLIC__/bt/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="__CSS__/style.css" rel="stylesheet" type="text/css">  
  <script src="__PUBLIC__/js/jquery/jquery-1.10.2.min.js"></script>
  <script src="__PUBLIC__/js/jquery/jquery-migrate-1.2.1.min.js"></script>
  <script src="__PUBLIC__/bt/js/bootstrap.min.js"></script>
 <block name="head_script"></block>
</head>
<body>
    <nav class="navbar navbar-inverse">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="__ROOT__/"><?php echo C('SITE_NAME'); ?></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">产品 <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="{:U('/products')}">全部产品</a></li>
                  
                  {~W('Menu/menu_show',array('category'))}	
                  	
                </ul>
              </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">图册 <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="{:U('/gallerys')}">全部产品</a></li>
                  
                  {~W('Menu/menu_show',array('gcategory'))}	
                  	
                </ul>
              </li>
            <li><a href="{:U('/blogs')}"><?php echo C('BLOG_TITLE'); ?></a></li>
            <li><a href="{:U('/about')}">关于我们</a></li>            
            <li><a href="{:U('/contact')}">联系我们</a></li>
          </ul>
          
          <ul class="nav navbar-nav navbar-right">
          	<li><a><span class="glyphicon glyphicon-earphone" aria-hidden="true"></span> <?php echo C('TELEPHONE'); ?></a></li>
          	<?php if(is_login()){ ?>
          	<li><a href="{:U('/order')}"><?php echo session('user_auth.username') ?></a></li>
          	<?php }else{ ?>
          	<li><a href="{:U('/login')}"><span class="glyphicon glyphicon-user" aria-hidden="true"></span></a></li>
          	<?php } ?>	
          	<li><a href="{:U('/cart')}"><span class="glyphicon glyphicon-shopping-cart" aria-hidden="true"></span>
          		<span id="cart-total"> <?php $t=session('cart_total');if(isset($t)){echo $t;}else{echo 0;} ?> </span></a>
          	</li>
          	
          </ul>
          
        </div>
      </div>
  </nav>	
  <block name="content"></block>  
  <footer>
    <div class="container">        
 
      <div class="credit">
        <p id="templatemo_cr_bar">
          Copyright © 2015 <a id="ypc" href=<?php echo C('SITE_URL'); ?>><?php echo C('SITE_NAME'); ?></a> <a id="bei" target="_blank" href="http://www.miitbeian.gov.cn"><?php echo C('SITE_ICP'); ?></a>
        </p>
      </div>
    </div>
  </footer>   
  <block name="foot_script"></block>
</body>
<html>


<block name="head_script">
 <link href="__CSS__/login.css" rel="stylesheet" type="text/css">	
</block>
<block name="content">
<section id="content-container">
<div class="container">
	<div class="row">
		<?php if(isset($error)) { ?>		
			<div class="alert alert-danger" role="alert">
			  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			  <div id="fail"><?php echo $error; ?></div>
			</div>		
		<?php } ?>
		<div id="content" class="col-md-24 col-sm-24 col-xs-24">
			<h1>注册用户</h1>
			<form class="register" method="post" action="{:U('/register')}">
				<div class="left">
					<h2 class="first">请填写您的帐号资料</h2>
					<div class="content">
						<table class="form">
					        <tr>
					          	<td>用户名<span class="required">*</span></td>
							</tr>
							<tr>
					          	<td>
					          		<input class="form-control" type="text" name="uname" value="{$uname}" />
					            	<?php if ($error_uname) { ?>
					            	<span class="error"><?php echo $error_uname; ?></span>
					            	<?php } ?>
					            </td>
					        </tr>

					        <tr>
					          	<td>联系人姓名<span class="required">*</span></td>
							</tr>
					        <tr>
					          	<td>
						          	<input class="form-control" type="text" name="name" value="{$name}" />
						            <?php if ($error_title) { ?>
						            <span class="error"><?php echo $error_title; ?></span>
						            <?php } ?>
					           	</td>
					        </tr>

							<tr>
					          	<td>联系人身份证<span class="required">*</span></td>
							</tr>
					        <tr>
					          	<td>
						          	<input class="form-control" type="text" name="id_card" value="{$id_card}" />
						            <?php if ($error_id_card) { ?>
						            <span class="error"><?php echo $error_id_card; ?></span>
						            <?php } ?>
					           	</td>
					        </tr>

					        <tr>
					          	<td>输入推荐人邀请码<span class="required">*</span></td>
							</tr>
					        <tr>
					          	<td>
						          	<input class="form-control" type="text" name="referee_code" value="{$referee_code}" />
						            <?php if ($error_referee_code) { ?>
						            <span class="error"><?php echo $error_referee_code; ?></span>
						            <?php } ?>
					           	</td>
					        </tr>

			                <div id="select-regName" class="item">
			                    <span class="label">通信地址：</span>
			                    <div class="fl item-ifo">
			                        <div class="o-intelligent-regName">
			                        <select id="loc_province"  style="width:120px;"></select>&nbsp;&nbsp;
			                        <select id="loc_city"  style="width:120px; margin-left: 10px"></select>&nbsp;&nbsp;
			                        <select id="loc_town"  style="width:120px;margin-left: 10px"></select>

			                        <!-- <input type="hidden" name="loc_province" id="loc_province_ok"> -->
			                        <!-- <input type="hidden" name="loc_city" id="loc_city_ok"> -->
			                        <!-- <input type="hidden" name="loc_town" id="loc_town_ok"> -->

			                        <input type="hidden" name="loc_province">
			                        <input type="hidden" name="loc_city" >
			                        <input type="hidden" name="loc_town" >

			                        </div>
			                    </div>
			                </div>
								<link href="__PUBLIC__/css/select2.css" rel="stylesheet"/>
								<script src="__PUBLIC__/js/jquery.js" type="text/javascript"></script>
		                  		<script type="text/javascript" src="__PUBLIC__/js/area/area.js"></script>
		                  		<script type="text/javascript" src="__PUBLIC__/js/area/location.js"></script>
		                  		<script src="__PUBLIC__/js/area/select2.js"></script>
		                  		<script src="__PUBLIC__/js/area/select2_locale_zh-CN.js"></script>
	

					        <tr>
					          	<td>具体地址<span class="required">*</span></td>
							</tr>
					        <tr>
					          	<td>
						          	<input class="form-control" type="text" name="address" value="{$address}" />
						            <?php if ($error_address) { ?>
						            <span class="error"><?php echo $error_address; ?></span>
						            <?php } ?>
					           	</td>
					        </tr>

							<tr>
								<td>邮箱<span class="required">*</span></td>
							</tr>
							<tr>
					          <td><input class="form-control" type="text" name="email" value="{$email}" />
					            <?php if ($error_email) { ?>
					            <span class="error"><?php echo $error_email; ?></span>
					            <?php } ?></td>
					        </tr>
					        
					        <tr>
								<td>密码<span class="required">*</span></td>
							</tr>
							<tr>
					          <td><input class="form-control" type="password" name="pwd" value="{$pwd}" />
					            <?php if ($error_pwd) { ?>
					            <span class="error"><?php echo $error_pwd; ?></span>
					            <?php } ?></td>
					        </tr>
					        <tr>
								<td>确认密码<span class="required">*</span></td>
							</tr>
							<tr>
					          <td><input class="form-control" type="password" name="repwd" value="{$repwd}" />
					            <?php if ($error_repwd) { ?>
					            <span class="error"><?php echo $error_repwd; ?></span>
					            <?php } ?></td>
					        </tr>

					        <tr>
					          	<td>手机号<span class="required">*</span></td>
							</tr>
					        <tr>
					          	<td>
						          	<input class="form-control" type="text" name="telephone" value="{$telephone}" id="regName"/>
						            <?php if ($error_telephone) { ?>
						            <span class="error"><?php echo $error_telephone; ?></span>
						            <?php } ?>
					           	</td>
					        </tr>
							
							<tr>
								<td>验证码<span class="required">*</span></td>
							</tr>
							<tr>
					          	<td>
					          		<input type="text" name="mobile_code" id="securityCode" class="text" style="width:80px;margin-right:15px;"/>
			                      	<input id="zphone" type="button" value=" 获取手机验证码 "  onclick="get_mobile_code();" style="width:142px;height:35px;">
			                      </td>
					        </tr>
						
							<!-- <div class="item">
			                    <span class="label">验证码：</span>
			                    <div class="fl item-ifo">
			                      <input type="text" name="mobile_code" id="securityCode" class="text" style="width:80px;margin-right:15px;"/>
			                      <input id="zphone" type="button" value=" 获取手机验证码 "  onclick="get_mobile_code();" style="width:142px;height:35px;">
			                    </div>
			                </div> -->


                  
   
	                    <script type="text/javascript">
	                      	function get_mobile_code(){
	                          	$.post("{:U('Public/sms')}", {mobile:jQuery.trim($('#regName').val()),send_code:<?php echo $_SESSION['send_code'];?>}, 
	                          		function(msg) {
	                              	alert(jQuery.trim(unescape(msg)));
	                              	if(msg=='提交成功'){
	                                  	RemainTime();
	                              	}
	                          	});
	                      	};

	                      	var iTime = 59;
	                      	var Account;
	                      	function RemainTime(){
	                          	document.getElementById('zphone').disabled = true;
	                          	var iSecond,sSecond="",sTime="";
	                          	if (iTime >= 0){
	                              	iSecond = parseInt(iTime%60);
	                              	iMinute = parseInt(iTime/60)
	                              	if (iSecond >= 0){
	                                  	if(iMinute>0){
	                                  	sSecond = iMinute + "分" + iSecond + "秒";
	                              	}else{
	                                  	sSecond = iSecond + "秒后重新发送";
	                              	}
	                          	}
	                              	sTime=sSecond;
	                              	if(iTime==0){
	                                  	clearTimeout(Account);
	                                  	sTime='获取手机验证码';
	                                  	iTime = 59;
	                                  	document.getElementById('zphone').disabled = false;
	                              	}else{
	                                  	Account = setTimeout("RemainTime()",1000);
	                                  	iTime=iTime-1;
	                              	}
	                          	}else{
	                              	sTime='没有倒计时';
	                          	}
	                          	document.getElementById('zphone').value = sTime;
	                      	} 
	                  	</script>




							<style type="text/css">
							    /* 图片 */
							    div.spot {
							                float: left;
							                margin: 0 20px 0 0;
							                width: 220px;
							                min-height: 160px;
							                border: 2px dashed #ddd;
							            }
							            .droparea {
							                position: relative;
							                text-align: center;
							            }
							            .droparea .instructions {
							                opacity: 0.8;
							                background-color: #cccccc;
							                height: 25px;
							                z-index: 10;
							                zoom: 1;
							                background-position: initial initial;
							                background-repeat: initial initial;
							                cursor: pointer;
							            }
							            .droparea div, .droparea input {
							                position: absolute;
							                top: 0;
							                width: 100%;
							                height: 100%; 
							            }
							            .droparea input {
							                cursor: pointer;
							                opacity: 0;
							            }
							            #uparea1,#uparea2,#uparea3,#uparea4{
							                height: 170px;
							                cursor: pointer;
							            }
							</style>

					        <tr>
		                        <th>身份证正面：</th>
		                        <td>
		                            <div class="droparea spot" id="image1" style="background-image: url('__UPLOAD__/image/regimage/{$info.idcadeimage1}');background-size: 220px 160px;" >
		                                <div class="instructions" onclick="del_image('1')">删除</div><div id="uparea1"></div>
		                                <input type="hidden" name="idcadeimage1" id="image_1" value="__UPLOAD__/image/regimage/{$info.idcadeimage1}" />
		                            </div>
		                        </td>
		                        <th>身份证反面：</th>
		                        <td>
		                            <div class="droparea spot" id="image2" style="background-image: url('__UPLOAD__/image/regimage/{$info.idcadeimage2}');background-size: 220px 160px;" >
		                                <div class="instructions" onclick="del_image('2')">删除</div><div id="uparea2"></div>
		                                <input type="hidden" name="idcadeimage2" id="image_2" value="__UPLOAD__/image/regimage/{$info.idcadeimage2}" />
		                            </div>
		                        </td>
		                        <th>居住地址证明：</th>
		                        <td>
		                            <div class="droparea spot" id="image3" style="background-image: url('__UPLOAD__/image/regimage/{$info.addressimage}');background-size: 220px 160px;" >
		                                <div class="instructions" onclick="del_image('3')">删除</div><div id="uparea3"></div>
		                                <input type="hidden" name="addressimage" id="image_3" value="__UPLOAD__/image/regimage/{$info.addressimage}" />
		                            </div>
		                        </td>
		                    </tr>


					        <js href="__PUBLIC__/kindeditor/kindeditor.js,__PUBLIC__/kindeditor/lang/zh_CN.js"/>
					        <script type="text/javascript">
					            function del_image(num) {
					                $('#image' + num).css('background-image', '');
					                $('#image_' + num).val('');
					            }
					            $(function() {

					                // var content;
					                // KindEditor.ready(function(K) {
					                //     content = K.create('#content', {
					                //         allowFileManager: true,
					                //         uploadJson: '__PUBLIC__/kindeditor/php/upload_json.php?dirname=joinmessage'
					                //     });
					                // });

					                KindEditor.ready(function(K) {
					                    K.create();
					                    var editor = K.editor({
					                        allowFileManager: true,
					                        uploadJson: '__PUBLIC__/kindeditor/php/upload_json.php?dirname=regimage'
					                    });
					                    K('#uparea1').click(function() {
					                        editor.loadPlugin('image', function() {
					                            editor.plugin.imageDialog({
					                                imageUrl: K('#image_1').val(),
					                                clickFn: function(url, title, width, height, border, align) {
					                                    $('#image1').css('background-image', 'url(' + url + ')').css('background-size', '220px 160px');
					                                    K('#image_1').val(url);
					                                    // K('#getImgUrl').val(url);
					                                    editor.hideDialog();
					                                }
					                            });
					                        });
					                    });
					                    K('#uparea2').click(function() {
					                        editor.loadPlugin('image', function() {
					                            editor.plugin.imageDialog({
					                                imageUrl: K('#image_2').val(),
					                                clickFn: function(url, title, width, height, border, align) {
					                                    $('#image2').css('background-image', 'url(' + url + ')').css('background-size', '220px 160px');
					                                    K('#image_2').val(url);
					                                    // K('#getImgUrl').val(url);
					                                    editor.hideDialog();
					                                }
					                            });
					                        });
					                    });
					                    K('#uparea3').click(function() {
					                        editor.loadPlugin('image', function() {
					                            editor.plugin.imageDialog({
					                                imageUrl: K('#image_3').val(),
					                                clickFn: function(url, title, width, height, border, align) {
					                                    $('#image3').css('background-image', 'url(' + url + ')').css('background-size', '220px 160px');
					                                    K('#image_3').val(url);
					                                    // K('#getImgUrl').val(url);
					                                    editor.hideDialog();
					                                }
					                            });
					                        });
					                    });
					                });
					                // $("#checkNewsTitle").click(function() {
					                //     if ($('#title').val() == '') {
					                //         popup.error('标题不能为空！');
					                //         return false;
					                //     }
					                //     $.getJSON("__URL__/checkProductTitle", {title: $("#title").val(), id: "{$info.id}"}, function(json) {
					                //         $("#checkNewsTitle").css("color", json.status == 1 ? "#0f0" : "#f00").html(json.info);
					                //     });
					                // });
					                // $(".submit").click(function() {
					                //     if ($('#title').val() == '') {
					                //         popup.error('标题不能为空！');
					                //         return false;
					                //     }
					                //     content.sync();
					                //     commonAjaxSubmit("{$action_url}");
					                //     return false;
					                // });
					            });
					        </script>
					        <tr>
								<td>用户注册协议<span class="required">*</span></td>
							</tr>
					        <tr>
					          <td><input type="checkbox" id="isread" name="isread" value="1" checked="checked">我已阅读并同意<a href="javascript:void(0)">《用户注册协议》</a>
					            <?php if ($error_isread) { ?>
					            <span class="error"><?php echo $error_isread; ?></span>
					            <?php } ?></td>
					        </tr>
							
							<!-- <dl class="accord clearfix">
		                      <dt></dt>
		                      <dd><input type="checkbox" id="isread" name="isread" value="1" checked="checked">我已阅读并同意<a href="javascript:void(0)">《用户注册协议》</a></dd>
		                    </dl> -->

					        <!-- <tr>
								<td>验证码<span class="required">*</span></td>
							</tr>
							<tr>
					          <td><input class="form-control" type="text" name="code" />
					            <?php if ($error_code) { ?>
					            <span class="error"><?php echo $error_code; ?></span>
					            <?php } ?></td>
					        </tr>
					        <tr>
								<td><img class="verifyimg reloadverify" alt="点击切换" src="{:U('Public/verify')}"></td>
							</tr> -->

						</table>
						    <div class="buttons">
						      	<div class="left">
						        	<input type="submit" value="提交" id="btnQuery" class="btn btn-primary btn-continue" />
						      	</div>
						    </div>
					</div>
				</div>				
			</form>
			<script>
                $(function () {
                    $('#btnQuery').click(function () {
                        var select2_chosen_1=$('#select2-chosen-1').html(); //省份
                        var select2_chosen_2=$('#select2-chosen-2').html(); //城市
                        var select2_chosen_3=$('#select2-chosen-3').html(); //区县

                        // $('#loc_province_ok').val(select2_chosen_1);
                        // $('#loc_city_ok').val(select2_chosen_2);
                        // $('#loc_town_ok').val(select2_chosen_3);

                        $("input[name='loc_province']").val(select2_chosen_1);
                        $("input[name='loc_city']").val(select2_chosen_2);
                        $("input[name='loc_town']").val(select2_chosen_3);
                    });
                })
            </script>
		</div>
		
	</div>	
</div>	
</section>
<style>
	.verifyimg{cursor:pointer;}
</style>
<script>
	//刷新验证码
	var verifyimg = $(".verifyimg").attr("src");
    $(".reloadverify").click(function(){
        if( verifyimg.indexOf('?')>0){
            $(".verifyimg").attr("src", verifyimg+'&random='+Math.random());
        }else{
            $(".verifyimg").attr("src", verifyimg.replace(/\?.*$/,'')+'?'+Math.random());
        }
    });	
</script>
</block>